# Claude Code への作業指示 (Phase 2: 品質保証とコア機能の強化)

あなたは `agent-factory-mcp` プロジェクトのエンジニアです。
以下の指示に従って、プロジェクトのテストカバレッジの向上、エラーハンドリングの強化、および初期設定のユーザビリティ向上（`init` コマンド）を行ってください。

## 1. コンテキストと目的

Phase 1.5 でテスト基盤が Vitest に移行され、Node.js 互換性が確保されました。
Phase 2 では、プロジェクトの信頼性と堅牢性を高めるため、コアコンポーネントのテストカバレッジを大幅に向上させ、ユーザーが簡単にセットアップできる仕組みを導入します。

## 2. タスク一覧

### A. テストカバレッジの向上 (Vitest)
以下のコンポーネントに対して、網羅的なユニットテストを追加実装してください。

1.  **`src/providers/base-cli.provider.ts`**
    *   目的: すべてのプロバイダーの基底クラスであるため、ここでのバグは致命的です。
    *   テスト項目:
        *   `executeCommand` の呼び出し検証 (Mock使用)
        *   コマンド構築ロジックの正確性
        *   エラー時の挙動

2.  **`src/utils/configLoader.ts` のエラーハンドリング**
    *   目的: 不正な設定ファイルによるクラッシュを防ぎます。
    *   テスト項目:
        *   壊れたJSONファイル
        *   必須フィールド欠落 (Schema Validation)
        *   ファイル権限エラー (`chmod` で再現)
        *   存在しないパス

3.  **`src/utils/logger.ts`**
    *   目的: ログ出力が適切に行われているか確認します。
    *   テスト項目:
        *   ログレベルによるフィルタリング (DEBUG vs INFO)
        *   フォーマット確認

### B. CI/CD でのカバレッジレポート統合
1.  **`vitest.config.ts` の更新**
    *   カバレッジレポートの出力設定を調整 (`text`, `json`, `html`)。
    *   カバレッジ目標値の設定 (例: 全体 80% 以上)。
2.  **GitHub Actions (`.github/workflows/ci.yml`) の更新**
    *   テスト実行ステップでカバレッジレポートを生成するオプションを追加。
    *   必要であればレポートをアーティファクトとしてアップロード。

### C. `init` コマンドの実装
1.  **対話型セットアップ機能**
    *   `src/index.ts` に `init` コマンドを追加 (例: `agent-factory-mcp init`)。
    *   ユーザーに対話形式 (`inquirer` 等を使用) で以下を質問し、`ai-tools.json` を生成する。
        *   使いたい AI ツール (リストから選択)
        *   カスタム設定 (Alias, System Prompt)
2.  **既存設定のマイグレーション**
    *   既にファイルがある場合は上書き確認を行う。

## 3. 作業手順

1.  **カバレッジ現状把握**: まず `npx vitest run --coverage` を実行し、現状の数値を記録する。
2.  **テスト実装**: 上記 A の各コンポーネントに対して `test/*.test.ts` を追加・修正する。
3.  **CI 設定**: GitHub Actions ワークフローを更新。
4.  **機能実装**: `init` コマンドを実装し、E2Eテスト (`test/e2e-init.test.ts` 等) を追加する。
5.  **最終確認**: `npm test` および `npx vitest run --coverage` が成功し、目標値を満たすことを確認する。

## 4. 完了条件
*   `BaseCliProvider`, `ConfigLoader`, `Logger` のユニットテストが存在し、パスすること。
*   `npm run coverage` (または相当するコマンド) で、カバレッジレポートが生成されること。
*   `agent-factory-mcp init` コマンドで対話的に `ai-tools.json` が生成できること。
*   既存の全テスト (Phase 1.5 で整備したもの) がリグレッションなくパスすること。
