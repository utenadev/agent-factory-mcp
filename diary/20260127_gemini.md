# 2026-01-27 Gemini's Diary

## 今日の実績

### 1. Phase 1.5 の完了 (Node.js 互換性)
- `package.json` のスクリプトから Bun 依存を排除し、`npm` スクリプトとして標準化。
- テストランナーを `bun:test` から `vitest` に完全移行。
- GitHub Actions の CI 設定を修正し、Node.js 18, 20, 22 環境での動作を保証。
- 最終的に `package-lock.json` を導入し、CI の依存関係解決エラー（Issue #3）を根治。

### 2. Phase 2 の完了 (品質と堅牢性)
- 主要コンポーネント（Provider, Registry, Factory）のカバレッジを 90-100% に引き上げ。
- `init` コマンドを実装し、ユーザーが対話形式で設定ファイルを作成できる機能を追加。
- 異常系テスト（壊れた JSON やスキーマ違反）を拡充。

### 3. PCP プロトコル (Pane Communication Protocol) の発明
- **課題**: エージェント（Gemini, Claude）間の連携手段が確立されていなかった。
- **解決策**: OS の基本機能（`tmux` + ファイルシステム）を活用した連携プロトコルを策定。
  - **Mailbox**: 指示やレポートをファイルとして `mailbox/` に保存。
  - **Bell**: `tmux send-keys` を用いて、相手のペインに通知を送り込む。
- **ツール**:
  - `scripts/postman.sh`: メッセージ送信エージェント。
  - `scripts/shogun.sh`: 連携環境（Gemini/Claude ペイン）を一撃で構築する「出陣」スクリプト。

## 学びと考察

### tmux の柔軟性と難しさ
- `postman.sh` の実装初期は、相手のペイン特定に苦戦した。ネストされた tmux 環境や、ウィンドウ/ペインの区別が曖昧だったことが原因。
- 最終的に「環境をスクリプトで構築して固定する (`shogun.sh`)」というアプローチに転換することで、確実な連携を実現した。"Infrastructure as Code" の精神はここでも有効だった。

### Claude との協働
- Gemini がプランナー、Claude がコーダーという役割分担が綺麗に機能した。
- 特にカバレッジ向上タスクにおいて、Claude の実装速度と精度は驚異的だった。
- `mailbox` を介した非同期コミュニケーションは、人間の介入（承認）を自然に挟めるため、安全で制御しやすい。

## 明日の予定
- `scripts/shogun.sh` を活用して、実際の開発フローを回してみる。
- ドキュメントやテストのカバレッジを維持しつつ、次のフェーズ（もしあれば）へ備える。
